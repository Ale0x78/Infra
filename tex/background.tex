\section{Background}
\label{sec:background}

In this section, we provide a background on current developments in phishing as a phenomenon and adversarial JavaScript techniques, as well as an overview of the parties involved in the phishing ecosystem.

\subsection{The Phenomenon of Phishing}
Phishing is a form of social engineering where an adversary pretends to be a trusted entity to steal a user's credentials or gain access to a specific machine, network, or account to which the user has access. While delivery mechanisms vary, most phishing eventually leads to a webpage that requests some personal information (usually credentials) from the user. 
Because some legitimate websites use web fingerprints as a secondary authentication vector, phishers now also use browser fingerprinting APIs to identify real users and exfiltrate fingerprints to pair with stolen credentials~\cite{sanchez-rolaRodsLaserBeams2023}. 

Phishing is ever-evolving and still growing in prevalence. Groups that track phishing saw an increase in phishing domains in the 2020s. The most popular target sectors vary each year, but include software-as-a-service and webmail services (Q3 2020), financial services (Q3 2021), and social media (2024)~\cite{APWGPhishingActivity}. In Q3 2024 alone, the Anti-Phishing Working Group (APWG) reported 900,000 phishing attacks. 

As more enterprises and researchers study and combat phishing, phishers respond with new countermeasures to prevent automated crawling and phishing detection, collectively called ``cloaking.''
If a phishing page determines the client is not a viable victim (e.g., a crawling bot, not in a specific country, etc.), it takes actions not to serve real phishing content.
The page may halt with an empty DOM or redirect to a benign page, a long-dead phishing page, or an affiliate marketing page.

Cloaking techniques can be broadly classified into server-side and client-side techniques~\cite{oest_inside_2018}.
Server-side techniques are stealthier, but they rely on limited information about the client.  
Most server-side techniques rely on precompiled deny-lists or allow-lists of IP addresses, user agents, or referers (the page from which the link is visited as identified by an HTTP header). 
% Although server-side code is usually inaccessible, researchers can still analyze it when phishers leave behind predeployment assets, usually in zip bundles called ``phishing kits.''


Client-side techniques allow for richer evasion strategies but are also more detectable. 
Phishing pages use browser APIs to trigger permission pop-ups to identify crawling browsers, which often cannot interact with the whole browser UI. 
Because cloaking is technically very similar to legitimate bot-detection and abuse prevention, 
phishers use CAPTCHA and click-through pages as client-side cloaking. Recently, phishing pages have used Cloudflare Turnstile, a popular widget for abuse prevention, to identify automated browsers. Figure~\ref{fig:cloudflare} shows a phishing page using a Cloudflare Turnstile when we crawled it.

Even the URL features of a phishing link contain techniques that have evolved to respond to anti-phishing research. Phishing pages frequently use URL shorteners (public or private) to obfuscate the final destination, landing pages requiring a user to follow hyperlinks to the actual page, and free web hosting with trustworthy top-level domains (TLDs). 

\subsection{Phishing as an ecosystem}
\input{figures/cloudflare}
Phishing is a logistical and technical challenge because a phisher must develop an effective phishing page with cloaking, find robust hosting for it, entice a victim to browse to it through SMS, email, or social media, exfiltrate the phished data, and then monetize the stolen credentials. This technical and logistical complexity, combined with interest from potential phishers, has created an underground economy to facilitate each step.

Phishing facilitators sell bundles of customizable or ready-to-deploy phishing pages known as ``phishing kits.''
They vary in features, sophistication, and cost. 
Phishing-as-a-service providers offer phishing kits and hosting services --- essentially turnkey phishing systems. Both products lower barriers to entry. Prior work has shown that phishing kits may steal credentials from their customers' kit deployments ~\cite{covaThereNoFree,mccalleyAnalysisBackDooredPhishing2011}, adapt or ``borrow'' features from other kits~\cite{intelligenceFrankenphishTodayZooBuilt2021}, and they are sometimes tied to specific actors ~\cite{unit42ThreatActorGroups2024}. In this paper, when two kits share the same set of features, and only differ in minor additions to new IPs in the blocklists, or different directory structure, we refer to them as being the same ``kit-family''
Phishing systems may store credentials on the same server, risking loss when the page is inevitably taken down, but a more common practice is to send them to the phisher over instant messaging channels.

Credential sales markets simplify monetization.
The credential sales part of the ecosystem has also adapted to modern MFA/2FA practices. With prior work showing that a browser fingerprint is enough to trick online services into triggering an MFA bypass~\cite{linPhishSheepClothing2022}, and has an increasing effect on the costs of stolen credentials~\cite {sanchez-rolaRodsLaserBeams2023}. 


\subsection{JavaScript}
Originally meant as a way of adding interactivity to webpages. The \js{} ecosystem has evolved to allow varying low-level features to webpages through Browser APIs. HTML DOM APIs enable developers to modify page appearance, while LocalStorage and IndexDB allow write access to the browser's internal storage buckets; meanwhile, the File System API can allow access to the user's real machine's storage. Browser APIs can be function calls (or constructors), property reads, and property writes. Most of the privileged functionality comes from function calls.

The dynamic nature of JavaScript enables a variety of techniques for concealing itself from analysis and detection. JavaScript obfuscation can transform a known malicious sample into an undetectable one. Webpack enables bundling benign and malicious scripts and wrangling them to make static analysis harder. The other side of obfuscation is evasions; in addition to making code comprehension (via human or machine) harder, malicious actors have deployed time bombs, offloading parts of the malicious script to be read from the DOM or via a network request, and avoid detection.~\cite{fv8-sec24}

\subsection{Hierarchical clustering}
This paper utilizes hierarchical clustering, an unsupervised learning technique for segmenting data into nested structures (clusters) to identify pages that share phishing kits from their client-side behaviors. Specifically, we use HDBSCAN, a hierarchical variant of the density-based DBSCAN clustering technique. Advantages of HDBSCAN include not requiring prior knowledge of the number of clusters, no hyper-parameter tuning required out of the box\footnote{Unlike DBSCAN, where you have to optimize towards an $\epsilon$ HDBSCAN picks the most stable clusters based on a center of mass}, and has been use by prior work for categorizing malware families\cite{fv8-sec24, Kizzle}.
When we can access ground truth, we utilize the V-measure and Fowlkes-Mallows index (FMI) to validate our clusters. Both are scores of 0 and 1 that address how well your clusters map to ground truth classes. V-measure (Validity measure) is the harmonic mean between completeness (all members of the same class are clustered together) and homogeneity (clusters only contain members of a single class) \cite{Rosenberg2007VMeasureAC}. FMI, on the other hand, is the geometric mean between precision and recall, providing a close analog for an F1 score in supervised learning.
When we do not have ground truth for the pages, we use the Silhouette score of all the clusters. Silhouette-score measures how well separated your clusters are, between -1 and 1. While usually used to fine-tune hyperparameters, we primarily use it to measure how well-formed the structures we extract out of HDBSCAN for all of the phishing pages are. Scores under zero signal overlapping structure, while scores above 0.5 and 0.7 indicate medium or firm separation. 