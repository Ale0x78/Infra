\section{Introduction}
\label{sec:intro}

% phishing is important
Web-based phishing attacks, where a webpage, through mimicking or urgency, tricks the user into submitting personal information to an attacker, have been increasing for the last 5 years~\cite{apwg}. Phishing attacks can have high-profile targets, like the NGOs and government workers targeted in 2021~\cite{intelligenceNewSophisticatedEmailbased2021,SophisticatedSpearphishingCampaign} and lead to more sophisticated cyberattacks and databreaches~\cite{ThreatActorLeverages2024}. Phishing kits, ready-to-deploy software packages sold at illicit markets for launching phishing attacks, have lowered the barrier of entry for malicious actors. Sellers often market phishing kits as bundles of quality-of-life features for attackers, such as built-in evasions from automated crawlers, exfiltration to Telegram channels, and obfuscation\cite{tejaswiLeakyKitsIncreased2022,oest_inside_2018}. Deploying these kits can be as easy as uploading them to free hosting providers and mass sending multiple links that exfiltrate the credentials to an endpoint you control.

% JavaScript is important because of evasions
One of the selling points of phishing kits is evasion, extending a phishing page's lifetime (delta time between deployment and discovery), and increasing the number of victims visiting the page without a browser warning. While server-side logic of kits can only make assumptions about the system based on the IP address and User agent, through API calls to the browser, client-side JavaScript code can query the user's system for CPU core counts, memory overhead, request user interaction, or call out to a 3rd party bot detection like CloudFlare\footnote{Simular to the phishing page that stole credentials from Troy Hunt, the maintainer of HaveIBeenPwned}~\cite{zhangCrawlPhishLargescaleAnalysis2021,zhangImSPARTACUSNo2022}. In the end, the JavaScript logic in a kit can range from a simple user-agent-based redirection to an AES-encrypted script that dynamically decrypts itself, identifies the browser through a series of API calls, and renders the page after confirming the victim is using a mobile device. Due to their mass-deployed and sold nature, phishing kits' exfiltration point, the targeted brand, or IP blocklists divide phishing kits into phishing kit families. 

% Our paper
We leverage this complexity of the page's JavaScript logic to cluster the pages, revealing when they shared a phishing kit family, and further annotate the clusters with what client-side techniques they employ. Crawling phishing pages from APWG, PhishTank, OpenPhish, URLScan, and PhishingDB for \daysCrawled{} days using an instrumented Chromium-based browser, VisibleV8\cite{vv8-imc19}; we visit over 1.3 million pages and identify the \totalNumberOfKitFamilies{} phishing kit families deployed behind \totalKitPages{} of these pages. This paper aims to aid researchers and analysts by automatically differentiating groups of phishing pages based on the underlying kit, a task previously done through manual analysis. Both have different uses for this form of grouping, as researchers can accurately control for mass-deployed kits when studying evasions and other client-side techniques, and analysts frequently tie malicious actors to novel kits\cite{Tycoon2FANewEvasion}.

By clustering pages based on their browser API usage, we construct groups of pages based on a shared set of techniques. Evaluating these groups over a ground truth dataset of URLs to kit-family mappings, we find that clustering over the set of browser APIs executed yields an FMI-based accuracy of \gtFMI{} and a validity score of \gtVS{}. We then turn the clustering approach to \totalPagesWithJavascriptFP{} pages, which we group into \totalClusters{} clusters. Figure~\ref{fig:pages_clusters_per_month} shows how the volume of pages/week can be by an order of magnitude when viewed as active clusters/week. We then use a predefined mapping of browser APIs to phishing techniques to better understand how widespread these practices are, while controlling for the mass deployment of a single kit. For example, Client-Side IP checks occur in \clientcheckPages{} pages; however, this totals to \clientcheckCluster{} clusters, and \clientcheckTopClusterPrecent{} of the pages come from a single cluster, which consists of Facebook business account phishing pages.
Overall, we offer the following contributions:

\todowrite{This intro is already long, but I want to move "the methodology in this paper is aimed at researchers and analysts. For research, id...For analysts, our methodology acts" from the discussion into here?}

\begin{contributions}
    \item We find that \emph{browser API usage alone} is sufficient to isolate and distinguish known phishing kit families. With a ground truth dataset of \totalNumberOfKitFamilies{} kit families deployed on \totalKitPages{} URLs, we achieve accuracy metrics of a \gtFMI{}\% Fowlkes-Mallows score and an \gtVS{}\% V-measure in the clusters of these pages relative to their kits used.
    \item We experimentally show that browser APIs common on the web (DOM APIs, property reads, etc.) serve as a valuable identifier for identifying kits, as they signal the kit developer's choices, and that the more sophisticated a page's client-side logic is, the more indicative it is of the underlying kit.
    \item We digest \totalPagesClusterable{} phishing pages into \totalClusters{} clusters, which allows us to observe that most clusters have short lives and target a single brand, suggesting that mass phishing campaigns gravitate towards low-quality, non-modular, and cheap or free kits. 
    \item We highlight how widespread different techniques are in the ecosystem by annotating dynamic traces of pages within a cluster and propagating the behavior to the cluster as a whole. When annotating all the clusters for the different techniques used, we find that UI-interactivity and basic fingerprinting are near-universal. At the same time, mouse detection via browser APIs, Cloudflare Turnstile embedding, and dynamic script creation are still relatively rare. We also note that compared to prior work, we observe a decreased ratio of pages that employ pop-ups as a form of bot detection.
    \item We release a dataset of \totalKitPages{} phishing pages labeled with their underlying kit and an unlabeled dataset of browser APIs executed on over 1.2 million pages collected throughout \daysCrawled{} days.
\end{contributions}

% How are we different from prior work
This work stands apart from prior research, as we automatically differentiate pages via all their browser APIs executed instead of static features or pre-trained classifiers. In doing so, we achieve a much higher accuracy than prior work, of F1=39.54\% from \cite{castanoPhiKitAPhishingKit2023}. Leveraging prior work into client-side cloaking and web privacy, we build a mapping of different evasion techniques (Fingerprinting, Obfuscation, CloudFlare Turnstile, Client-side IP check, etc.) that a phishing page may employ and provide an up-to-date and mass-deployment-resilient description of how widespread these are.
\input{figures/clusters_per_month}
